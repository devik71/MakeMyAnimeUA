# üîß –í–∏–ø—Ä–∞–≤–ª–µ–Ω–Ω—è –ø–æ–º–∏–ª–æ–∫ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –≤—ñ–¥–µ–æ

## üêõ **–ü—Ä–æ–±–ª–µ–º–∞:**
–ü—Ä–∏ —Å–ø—Ä–æ–±—ñ –∑–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏ —Ñ–∞–π–ª –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á –æ—Ç—Ä–∏–º—É–≤–∞–≤ –ø–æ–º–∏–ª–∫—É –ø—Ä–æ "HTML JSON" –ø—ñ–¥ —á–∞—Å –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –≤—ñ–¥–µ–æ.

## üîç **–î—ñ–∞–≥–Ω–æ—Å—Ç–∏–∫–∞:**

### **–í–∏—è–≤–ª–µ–Ω—ñ –ø—Ä–æ–±–ª–µ–º–∏:**
1. ‚ùå **JavaScript Route Mismatch**: –∑–∞–ø–∏—Ç –π—à–æ–≤ –Ω–∞ `/upload`, –∞ route –Ω–∞–∑–∏–≤–∞–≤—Å—è `/upload_video`
2. ‚ùå **–ù–µ–¥–æ—Å—Ç–∞—Ç–Ω—è –≤–∞–ª—ñ–¥–∞—Ü—ñ—è —Ñ–∞–π–ª—ñ–≤**: –Ω–µvalid —Ñ–∞–π–ª–∏ –ø—Ä–æ—Ö–æ–¥–∏–ª–∏ –ø–æ—á–∞—Ç–∫–æ–≤—É –ø–µ—Ä–µ–≤—ñ—Ä–∫—É
3. ‚ùå **–ù–µ—ñ–Ω—Ñ–æ—Ä–º–∞—Ç–∏–≤–Ω—ñ –ø–æ–º–∏–ª–∫–∏**: users –æ—Ç—Ä–∏–º—É–≤–∞–ª–∏ –∑–∞–≥–∞–ª—å–Ω—ñ –ø–æ–º–∏–ª–∫–∏ –±–µ–∑ –¥–µ—Ç–∞–ª–µ–π
4. ‚ö†Ô∏è **ffmpeg –∑–∞–ª–µ–∂–Ω—ñ—Å—Ç—å**: ffprobe –±—É–≤ –ø–æ—Ç—Ä—ñ–±–µ–Ω –¥–ª—è –∞–Ω–∞–ª—ñ–∑—É –≤—ñ–¥–µ–æ

## ‚úÖ **–í–∏–ø—Ä–∞–≤–ª–µ–Ω–Ω—è:**

### **1. –í–∏–ø—Ä–∞–≤–ª–µ–Ω–æ JavaScript –º–∞—Ä—à—Ä—É—Ç–∏:**
```javascript
// –ë—É–ª–æ:
fetch('/upload', { method: 'POST', body: formData });

// –°—Ç–∞–ª–æ:
fetch('/upload_video', { method: 'POST', body: formData });
```

### **2. –î–æ–¥–∞–Ω–æ –ø–æ–∫—Ä–∞—â–µ–Ω—É –≤–∞–ª—ñ–¥–∞—Ü—ñ—é —Ñ–∞–π–ª—ñ–≤:**

#### **–°–µ—Ä–≤–µ—Ä–Ω–∞ –≤–∞–ª—ñ–¥–∞—Ü—ñ—è:**
```python
def is_valid_video_file(file_path):
    """–î–æ–¥–∞—Ç–∫–æ–≤–∞ –ø–µ—Ä–µ–≤—ñ—Ä–∫–∞ —á–∏ —Ñ–∞–π–ª —î –≤–∞–ª—ñ–¥–Ω–∏–º –≤—ñ–¥–µ–æ"""
    try:
        probe = subprocess.run([
            "ffprobe", "-v", "error", "-select_streams", "v:0", 
            "-show_entries", "stream=codec_type", "-of", "csv=p=0", str(file_path)
        ], capture_output=True, text=True, timeout=10)
        
        return probe.returncode == 0 and "video" in probe.stdout
    except Exception:
        return False
```

#### **–ö–ª—ñ—î–Ω—Ç—Å—å–∫–∞ –≤–∞–ª—ñ–¥–∞—Ü—ñ—è:**
```javascript
function validateFile(file) {
    const allowedTypes = ['video/mp4', 'video/x-msvideo', 'video/quicktime', 'video/x-matroska'];
    const maxSize = 2 * 1024 * 1024 * 1024; // 2GB
    
    if (!allowedTypes.includes(file.type) && !file.name.match(/\.(mp4|avi|mov|mkv)$/i)) {
        showError('–ü—ñ–¥—Ç—Ä–∏–º—É—é—Ç—å—Å—è —Ç—ñ–ª—å–∫–∏ –≤—ñ–¥–µ–æ —Ñ–∞–π–ª–∏: MP4, AVI, MOV, MKV');
        return false;
    }
    
    if (file.size > maxSize) {
        showError('–§–∞–π–ª –∑–∞–Ω–∞–¥—Ç–æ –≤–µ–ª–∏–∫–∏–π. –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∏–π —Ä–æ–∑–º—ñ—Ä: 2GB');
        return false;
    }
    
    return true;
}
```

### **3. –ü–æ–∫—Ä–∞—â–µ–Ω–æ –æ–±—Ä–æ–±–∫—É –ø–æ–º–∏–ª–æ–∫:**

#### **–î–µ—Ç–∞–ª—å–Ω—ñ—à—ñ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –ø—Ä–æ –ø–æ–º–∏–ª–∫–∏:**
```python
def analyze_video(video_path):
    try:
        # –ü–µ—Ä–µ–≤—ñ—Ä—è—î–º–æ —á–∏ —Ñ–∞–π–ª —ñ—Å–Ω—É—î
        if not video_path.exists():
            return {"error": "–§–∞–π–ª –Ω–µ –∑–Ω–∞–π–¥–µ–Ω–æ"}
            
        # –î–µ—Ç–∞–ª—å–Ω—ñ—à–∞ —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—è –ø—Ä–æ –ø–æ–º–∏–ª–∫—É ffprobe
        if probe.returncode != 0:
            error_msg = probe.stderr if probe.stderr else "–ù–µ–≤–∞–ª—ñ–¥–Ω–∏–π –≤—ñ–¥–µ–æ —Ñ–∞–π–ª"
            return {"error": f"–ü–æ–º–∏–ª–∫–∞ ffprobe: {error_msg}"}
```

#### **–ü–æ–∫—Ä–∞—â–µ–Ω–∞ –æ–±—Ä–æ–±–∫–∞ –≤ JavaScript:**
```javascript
if (!response.ok) {
    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
}

const result = await response.json();

if (result.error) {
    showError(result.error);
    return;
}
```

### **4. –î–æ–¥–∞–Ω–æ —Å–∏—Å—Ç–µ–º–Ω—ñ –∑–∞–ª–µ–∂–Ω–æ—Å—Ç—ñ:**
```bash
sudo apt update && sudo apt install -y ffmpeg
```

## üß™ **–¢–µ—Å—Ç—É–≤–∞–Ω–Ω—è:**

### **–¢–µ—Å—Ç –∑ –Ω–µ–≤–∞–ª—ñ–¥–Ω–∏–º —Ñ–∞–π–ª–æ–º:**
```bash
$ echo "test video content" > test_video.mp4
$ curl -X POST -F "video=@test_video.mp4" http://localhost:5001/upload_video
{
  "error": "–ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–∏–π —Ñ–∞–π–ª –Ω–µ —î –≤–∞–ª—ñ–¥–Ω–∏–º –≤—ñ–¥–µ–æ —Ñ–∞–π–ª–æ–º. –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ —Ñ–æ—Ä–º–∞—Ç —Ç–∞ —Ü—ñ–ª—ñ—Å–Ω—ñ—Å—Ç—å —Ñ–∞–π–ª—É."
}
```

### **–†–µ–∑—É–ª—å—Ç–∞—Ç:**
‚úÖ **–ó—Ä–æ–∑—É–º—ñ–ª–∞ –ø–æ–º–∏–ª–∫–∞ —É–∫—Ä–∞—ó–Ω—Å—å–∫–æ—é –º–æ–≤–æ—é**  
‚úÖ **–ù–µ–≤–∞–ª—ñ–¥–Ω–∏–π —Ñ–∞–π–ª –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –≤–∏–¥–∞–ª—è—î—Ç—å—Å—è**  
‚úÖ **HTTP —Å—Ç–∞—Ç—É—Å–∏ –∫–æ—Ä–µ–∫—Ç–Ω—ñ (400 –¥–ª—è –ø–æ–º–∏–ª–æ–∫ –≤–∞–ª—ñ–¥–∞—Ü—ñ—ó)**

## üìã **–í–∏—Å–Ω–æ–≤–æ–∫:**

**–ü—Ä–æ–±–ª–µ–º–∞ "HTML JSON"** –±—É–ª–∞ –≤–∏–∫–ª–∏–∫–∞–Ω–∞:
1. **–ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–∏–º –º–∞—Ä—à—Ä—É—Ç–æ–º** - JavaScript –∑–≤–µ—Ä—Ç–∞–≤—Å—è –Ω–µ –¥–æ —Ç–æ–≥–æ endpoint
2. **–ù–µ–¥–æ—Å—Ç–∞—Ç–Ω—å–æ—é –≤–∞–ª—ñ–¥–∞—Ü—ñ—î—é** - –Ω–µ–≤–∞–ª—ñ–¥–Ω—ñ —Ñ–∞–π–ª–∏ –ø—Ä–æ—Ö–æ–¥–∏–ª–∏ –Ω–∞ –µ—Ç–∞–ø –∞–Ω–∞–ª—ñ–∑—É
3. **–ü–æ–≥–∞–Ω–æ—é –æ–±—Ä–æ–±–∫–æ—é –ø–æ–º–∏–ª–æ–∫** - –ø–æ–º–∏–ª–∫–∏ ffprobe –±—É–ª–∏ –Ω–µ—ñ–Ω—Ñ–æ—Ä–º–∞—Ç–∏–≤–Ω–∏–º–∏

**–ü—ñ—Å–ª—è –≤–∏–ø—Ä–∞–≤–ª–µ–Ω–Ω—è:**
- ‚úÖ –í—Å—ñ –º–∞—Ä—à—Ä—É—Ç–∏ –ø—Ä–∞—Ü—é—é—Ç—å –ø—Ä–∞–≤–∏–ª—å–Ω–æ
- ‚úÖ –§–∞–π–ª–∏ –≤–∞–ª—ñ–¥—É—é—Ç—å—Å—è –Ω–∞ 3 —Ä—ñ–≤–Ω—è—Ö: —Ä–æ–∑—à–∏—Ä–µ–Ω–Ω—è ‚Üí MIME —Ç–∏–ø ‚Üí ffprobe
- ‚úÖ –ö–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ –æ—Ç—Ä–∏–º—É—é—Ç—å –∑—Ä–æ–∑—É–º—ñ–ª—ñ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è —É–∫—Ä–∞—ó–Ω—Å—å–∫–æ—é
- ‚úÖ –ù–µ–≤–∞–ª—ñ–¥–Ω—ñ —Ñ–∞–π–ª–∏ –Ω–µ –∑–∞–π–º–∞—é—Ç—å –¥–∏—Å–∫–æ–≤–µ –º—ñ—Å—Ü–µ

## üéØ **–ù–∞—Å—Ç—É–ø–Ω—ñ –∫—Ä–æ–∫–∏:**
1. –ü—Ä–æ—Ç–µ—Å—Ç—É–≤–∞—Ç–∏ –∑ —Ä–µ–∞–ª—å–Ω–∏–º–∏ –≤—ñ–¥–µ–æ —Ñ–∞–π–ª–∞–º–∏
2. –î–æ–¥–∞—Ç–∏ –ø—ñ–¥—Ç—Ä–∏–º–∫—É –±—ñ–ª—å—à–µ –≤—ñ–¥–µ–æ —Ñ–æ—Ä–º–∞—Ç—ñ–≤ –ø—Ä–∏ –ø–æ—Ç—Ä–µ–±—ñ
3. –ú–æ–∂–ª–∏–≤–æ –¥–æ–¥–∞—Ç–∏ preview –¥–ª—è –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–∏—Ö –≤—ñ–¥–µ–æ